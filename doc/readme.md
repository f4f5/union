# 前期配置

## git 安装

* 简要的说 git 的作用： 

    我们在开发代码时，想象一个大一点的项目，每天就会都有一些更改。假如某一天改着改着突然发现出现了一个灾难性的问题。这时候一般就会想着和原先没有这个大问题时候的代码做一个对比，发现改动的地方，查找引发这个灾难的地方。

    git 就提供了这样的功能，git在每次提交（commit）代码的时候，都会自己隐藏的建立代码的版本信息，每次commit就是一个版本。然后就可以用git进行各种版本对比，版本回退等等工作。

    还有，就是在多人开发一个项目的时候，git也会帮助处理开放中的改动冲突，对代码进行合并等。举例说，A开发sk.py 文件， B开发sjgskjg.js 文件，他们提交到同一个地方的更改时，git就帮助合并他们的更改，保证项目都是最新的。

<a href="https://www.jianshu.com/p/414ccd423efc">git 安装教程</a>

<a href="https://www.cnblogs.com/tugenhua0707/p/4050072.html">git 使用教程</a>

安装完成后，就可以用git bash 里的 ssh 命令登录我们的远程服务了
登录命令是 ssh root@78.141.190.51
之后输入密码就行。


# Union 的设计逻辑

## 定义
* union &nbsp;&nbsp;&nbsp;&nbsp;    项目名称，union是多台主机采用统一规范组成的一个网络. 一般的，一台电脑主机就是一个union节点，一个节点包含：连接器、区块链、服务三类进程。
* 连接器 &nbsp;&nbsp; &nbsp;  union系统的一个进程，帮助在union系统的每台主机维护一份资源定位表
* 区块链 &nbsp; 区块链服务为系统提供虚拟货币和智能合约功能。
* 服务  &nbsp;&nbsp; &nbsp;    服务也是一个进程，为客户端提供特定的服务。
* 资源定位表 &nbsp; 每台主机都会有的一份json文件，保存了union系统里的每个节点的连接信息
* 客户端 &nbsp;&nbsp; &nbsp; 客户端可以是浏览器、app；客户端首先连接任意节点更新资源定位表，之后连接 区块链 进行 钱包/身份 认证，之后在连接服务获得服务。

Union系统是一整套的软件。通过它可以连接世界各地的电脑，并让这些电脑架设统一的服务（软件），再由系统内的资源定位表提供给客户端自由的访问这些资源。我们每个人的个人电脑都是独立的，很多时候会有资源浪费，假如有一个软件，你只要运行它，就能出售自己电脑上多余的计算资源，获得相应的收入，那将会是很好的事。目前，有些国家会对一些常用的网站进行封锁，限制，造成互联网的不自由。思想有好的，也有坏的；检验的标准不是个人也不是民族的意志，而是用时间，淘优汰劣。Union就是要实现计算资源的有效利用与互联网自由。

Union是个很庞大的项目，是一整套分布式的服务网络，而且会有各种不同类型的服务各司其职，互相交互，就如同一个抽象的虚拟公司 。区块链司财务与身份验证，连接器司各类资源定位，各种类型的服务为终端用户提供各种有价服务赚取收益 。涉及到socket 、数据库、支付体系、网站建设、移动端 App （没做）、网络安全、区块链等

举例说：假设有网站A，还有游戏服务B想架设在Union上；那么Union会分配网络内的一部分主机（个人电脑）的服务使用网站A，一部分主机的union服务使用B；当客户端想访问网站A时，可以先从Union网络内的任意节点获得资源定位表，然后挑选合适的架设了A网站的主机访问A网站；所以A网站在设计时只需要符合union的一些编写规范就行。资源定位表是Union内的每台主机都会有的，所以只要客户端连接上Union内的任意一台主机，几乎就能获得网络内的所有资源。

以上是一个主体的思想，因为Union内的主机可以架设任意服务，所以当然也可以是VPN。整套网络需要一个安全机制，奖惩机制，身份验证机制，这都是通过区块链技术实现的。上一段说到的资源定位表，也需要一个额外的服务对这个表进行更新维护，我们把这个服务称为连接器。这些就是Union系统最主要的三个部分：区块链部分， 可插拔的服务， 连接器。 当然，还需要额外的客户端程序，这样才好访问整个网络。

## 区块链
区块链部分就是整套系统的奖惩以及账户管理系统。 会有用户钱包以及内置的虚拟币，暂定名字为unionCoin。 目前主要基于一个开源的区块链框架<a href="https://developers.eos.io/eosio-home/docs">EOSIO</a>

区块链也可以认为是一种服务的一种，只是这种服务是官方提供的，或者说不可缺少的。虽然从功能上，可以不使用区块链而是额外的编写程序实现账户管理、充值平台币等功能。并且这样还能避免区块链的一些吞吐量等问题。但union系统本身是开放性的，分布式的，公信力来源于公众的参与。union会从公众中挑选出有限的几个代表，对整个系统的未来发展做出贡献。任意一个个体无法对整个系统做出随意的更改，改变的权限以及规则会写入代码————这些很多理念可以借鉴于区块链，互为参考。所以，区块链是不可替代的，因为它正好符合union系统。

union系统的目标是整合资源做一些“超乎想象”的事，当然这些讨论要在union系统获得成功后才有意义。外太空探索、强人工智能、永生、脑机接口等等，这些超现实的研究无论是一个国家、民族、公司可能都不能很好的胜任。这些研究是全人类的事，union系统也正好可以是一个超脱于国家、民族、公司界限的产品。设定这个终极目标可以让union在获得成功后不会资源滥用，也可以让union与全人类文明共同进步。区块链的引入正好可以实现上文的一些设想。很多规则可写入智能合约执行作为约束。而区块链本身监管着资源的分配，只需要设定合适的任务，就可以有效的朝目标前进。而且区块链也使得这些公开透明化，大众监管，可参与。

Union采用的是EOS.IO系统，考虑到为了维持用户的可能性增长，将会部署多条区块链。举例说，每100万人共用一条链，之后的人，将会加入另外的一条链，链与链之间可以进行跨链交易。所有的链都采用EOS系统，都用同一套货币。当然，客户端用户不会感觉到有什么区别。客户端将首先从官网登录，然后获取它的账号所对应的链，再从连接器获得可用的服务器ip，然后就可以接入到区块链进行交易了。

从设计上，区块链暂时只需要搭建起来接入整套系统就行，后继的开发会需要但是不是当前阶段所必须的，当前需要的功能eos大都自带了。其它的功能更多的主要是由官网提供，包括账号登录，基本信息展示。官网也是分布式的，没有区块链那么“分布”，官网和区块链的关系可以认为区块链只是实现了官网当中“管钱”的功能。

## 连接器
连接器是一个独立的进程，它将帮助更新和维护资源定位表，并帮助调度客户端的连接。资源定位表包含Union中每个服务的所有信息。因为整个网络是动态的，所以这个文件也会随时间变化。连接器将帮助进行资源定位表的增、删、改、查。资源定位表将按IP、服务类型、端口、剩余连接、位置等描述服务。资源定位表内容如下：

```
resource_mains:    //主资源文件
{
    ip_x: {
        ip:
        server_type: []
        remain_connections: []
        score:
        location:
    }    
}
locations:   //下面的数据结构帮助更快的搜索资源
{
    location_x: {  //是该按国家进行划分吗？ 待定
        ip:
    }
}

scores: [1st ip, 2ed ip, 3rd ip, 4th ip, ...]  //前100个性能最好的主机

server_types:
{
    type_x: [ip_x]
}

remainconnections:{
    unremain: [],
    remain10: [],
    remain100: [],
    remain1000: [],
    remain10000: [],
    unlimit: []
}

```

连接器将自动选择前100个SOCRE最高的计算机作为主节点。score越高意味着电脑在各种操作中都很快。经过一段时间后，普通节点将随机选择一个主节点来更新其资源定位表（如果需要）。

***删除失败的节点***

有两种状况，一个是失效节点是主节点，另一个是失效节点是普通节点。

*主节点故障*

* 如果失败的节点是主节点，当普通节点周期性地请求其父节点维持心跳时（该节点先前连接的主节点是父节点），如果请求被阻止，该节点将选择另一个主节点并将被阻止的主节点（原 父节点）报告给所选的主节点，然后所选的主节点将检查这个被阻塞的主节点状态，并更新资源定位表。为了实现这一点，普通节点会将曾连接的主节点作为其父节点来维护。

*普通节点故障*

* 主节点应该维护一个包含其所有子节点及其最新连接时间的表。如果心跳时间超出范围，父节点将尝试连接此节点并进行检查。如果失败，删除它，更新资源定位表。

***添加新节点***

* 如果一个新节点想要加入网络，它必须至少知道这个网络的一个节点的地址（IP，端口）。首先，它连接到该地址，并检索资源定位表。其次，根据当前资源定位表选择一个主节点，并连接到主节点。最后，在主节点接收到这些信息后，它将更新资源定位表。

***更新资源定位表***

* 只有主节点可以更新资源定位表。当一个主节点的资源定位表更新后，它将广播到所有主节点，所有主节点进行更新。当一个主节点接收到一个主节点的更新广播时，必须检查更新的节点是否有效，如果一个主节点在1小时内广播10次无效的节点，该节点将被放入一个主节点黑名单中一天。如果一个正常的节点在1小时内重新连接（不稳定）10次，它将在1小时内被此网络阻止。

***路由逻辑***

* 假设一个主节点连接失败，它将被从主节点列表中删除。然后选择一个新节点添加到主节点列表中。首先，新的主节点将没有子节点，因此没有父节点的普通节点将首先选择子节点少的主节点连接。当所有主节点的子节点数量达到一个大致的平衡是，我们就要考虑到主节点与子节点的距离问题。因为子节点与主节点之间的通信是很频繁的，所有选择较近的节点做为主节点是很有必要的。

* 主节点将有自己的容量。所有接收连接的主节点都应该保持某种平衡。应该有一个函数来计算主节点连接的中值点。连接首先遵循就近原则，然后再挑选链接数少的。假设我们有一个函数可以计算正常节点连接到的所有主节点的效率。或者说是，延误率或损失率或它们两者的综合的一个评分，这个评分越低越好或越大越好。这时普通节点应该总是选择最好的主节点连接。算法将是：

```
choose_best_main_node(current_node):
    efficients = []
    for node in main_node_list:
        efficents.push(comprehensive_efficient(current_node, node) )
    index = maxIndexOf(efficients)
    return efficients[index]
```

### 连接器流程设计
`增  删   改   查`

`选择100个资源最优的节点作为主节点`

`每个主节点有n个子节点，每个子节点选取连接最快的主节点作为主节点。主节点才有增删改的权力。`

流程 1: 
* 初始化节点， 加载配置文件，获取本机的配置信息、网络宽带等信息，配置文件描述了服务类型、服务端口等等信息


流程 2:  函数  connect_2_network
* 检查自身，获取相关信息  ...正在做
* 连接上union网络，获取网络上的资源配置表   ... 正在做
* 选择合适的主节点连接，进一步获取信息
* 看看自己是否可以作为主节点

流程3:
* 周期性的上传本节点信息到自己的主节点
* 周期性与主节点同步资源定位表信息
* 如果主节点阻塞， 更换自己的主节点，并且告诉新的主节点 原主节点阻塞

流程4:
* 主节点检查自己的子节点心跳，剔除不活跃的子节点，并向其它主节点同步剔除信息

流程5:
* 主节点之间交互信息

流程6: 
* 删除老的主节点，选择新的主节点

## 服务
服务可以分为“官方”指定的一些服务，还有一些私人架设的服务，当然之后要讨论的都是*官方服务*。也可以按照提供的服务类型来进行划分，例如提供某些特定网站的网站服务，提供身份识别与财务功能的区块链服务等。

### 区块链
区块链其实也属于为服务的一部分，只是区块链类的服务在系统中的重要性比较高。结构上都是类似的，每一类服务都自己处于自己的子网中，同时也可以通过资源定位表访问其它子网。目前依据交易吞吐，采用了EOS系统作为区块链部分。由于Union系统本身的一些特性，会对一些智能合约做出一些改动。区块链保存了所有用户的钱包类信息，交易信息，等等。虽然区块链是去中心化的，但是在Union里也可以认为是中心化的。可以简单认为区块链只提供了钱包维护和钱包间的转账功能。通过EOS的配置文件，可以使得区块链网络连接到Union系统。

### 官方网站
官网一打开应该是一个面板类的页面，在其中可以添加、搜索自己感兴趣的服务。有一些服务是必须的，例如个人中心（钱包）、官方信息、VPN、交易市场等。

用户一般需要登录到官网获取更多的服务，登录官网后一般也就登录了钱包。用户的个人信息会保存在分布式的数据库中。用户先登录官网，获取区块链的登录信息，然后登录到区块链获取钱包相关的信息,在钱包展示页面有转账等选项。

### 交易市场
交易市场是官网功能的一个部分。价格走势图像/挂单交易/法币兑换等  

### VPN
GitHub的 f4f5 里已经上传的shadowsocks就是一个VPN服务的源码。这个不是我写的，是网上开源的。


## Client API
## Server API

